# 2048

ターミナルで動作する2048ゲームのC言語実装です。ncursesライブラリを使用した美しいUIと、アニメーション効果を備えています。

<img width="756" height="508" alt="image" src="https://github.com/user-attachments/assets/9daf192a-603e-4834-b6c1-8d45a9226a6c" />

## 特徴

- 🎮 **カラフルなUI**: タイルの値に応じた色分け表示
- 🎨 **ASCII アート**: 42スタイルのASCIIアートで数字を表示
- 📐 **複数のボードサイズ**: 4x4 と 5x5 のボードに対応
- 🏆 **スコア記録**: ベストスコアをファイルに保存
- 🎯 **勝利後も継続可能**: 2048達成後もプレイを続けられる拡張モード
- 🪟 **画面リサイズ対応**: ターミナルのサイズ変更に自動対応
- ✨ **アニメーション**: メニュー画面での雨のエフェクト

## 動作環境

- Linux または macOS
- ncurses ライブラリ
- C コンパイラ (gcc/clang)

## インストール

### 依存関係のインストール

**Ubuntu/Debian:**
```bash
sudo apt-get install libncurses5-dev libncursesw5-dev
```

**macOS (Homebrew):**
```bash
brew install ncurses
```

### ビルド

```bash
# クローン
git clone <repository-url>
cd 2048

# ビルド
make

# 実行
./2048
```

## 使い方

### ゲームの起動

```bash
./2048
```

### 操作方法

**メニュー画面:**
- `↑/↓`: 選択肢の移動
- `1`: 4x4 ボードでゲーム開始
- `2`: 5x5 ボードでゲーム開始
- `Enter`: 選択した項目を決定
- `ESC`: 終了

**ゲーム画面:**
- `↑/↓/←/→`: タイルを移動
- `ESC`: メニューに戻る

<img width="1628" height="892" alt="image" src="https://github.com/user-attachments/assets/880c89ed-da1b-431d-89d9-4e5d45d434ea" />

### ゲームルール

1. 矢印キーでタイルを上下左右に移動させます
2. 同じ数字のタイルがぶつかると、1つに合体して数字が倍になります
3. 移動するたびに新しいタイル（2または4）が追加されます
4. **2048のタイルを作ると勝利**です
5. 移動できるスペースがなくなるとゲームオーバーです

### 勝利後の選択

2048に到達すると、以下の選択肢が表示されます：
- プレイを継続（2048タイル同士の合体は不可）
- メニューに戻る

## 開発

### デバッグビルド

メモリエラーを検出するAddressSanitizerを有効にしたデバッグビルド：

```bash
make debug
./2048_debug
```

### クリーンビルド

```bash
make fclean  # すべてのビルド成果物を削除
make re      # リビルド
```

### プロジェクト構成

```
.
├── cmd/                    # メインアプリケーションコード
│   ├── main.c             # ゲームループと移動ロジック
│   ├── presentation.c     # UI描画・レンダリング
│   ├── color.c            # カラー設定
│   ├── utils.c            # ファイルI/O（スコア保存）
│   └── game.h             # 型定義と関数宣言
├── pkg/                   # libftライブラリ
│   ├── ft_*.c             # 標準C関数の実装
│   └── libft.h            # ライブラリヘッダー
└── Makefile               # ビルド設定
```

### カスタマイズ

#### 勝利条件の変更

`cmd/game.h` の `WIN_VALUE` を編集：

```c
enum e_const {
  WIN_VALUE = 2048,  // 勝利条件（2のべき乗である必要があります）
};
```

#### 最小画面サイズの変更

`cmd/game.h` で定義されています：

```c
enum e_window_flag {
  WINDOW_MIN_WIDTH = 32,   // 最小幅
  WINDOW_MIN_HEIGHT = 15,  // 最小高さ
  // ...
};
```

## 技術詳細

### 使用ライブラリ

- **ncurses**: ターミナルUI制御
- **libft**: カスタムC標準ライブラリ（42スタイル）

### シグナル処理

- `SIGWINCH`: ウィンドウサイズ変更を検知
- `SIGINT`: Ctrl+C による安全な終了

### データ永続化

ベストスコアは `bestscore.txt` に保存されます。ゲームが正常終了した場合のみ、現在のスコアがベストスコアより高い場合に更新されます。

## 既知の制限事項

### メモリリーク警告

Valgrindでメモリチェックを行うと、ncursesライブラリ内部でメモリリークが報告されますが、これはライブラリの実装によるもので、アプリケーション側のバグではありません。詳細は `docs/ncurses-とメモリリーク.md` を参照してください。

### 画面サイズ

ゲームを快適にプレイするには、最低でも32x15文字のターミナルサイズが必要です。画面が小さすぎる場合は警告メッセージが表示されます。
